# Antigravity For Loop æŠ€è¡“ç ”ç©¶å ±å‘Š

> æœ€å¾Œæ›´æ–°ï¼š2026-01-05
>
> æœ¬æ–‡æª”æ•´åˆäº† Google Antigravity IDE å’Œ Claude Code çš„ Hooks æ©Ÿåˆ¶ç ”ç©¶ï¼Œä»¥åŠå¦‚ä½•å¯¦ç¾è‡ªå‹•è¿­ä»£å¾ªç’°æ’ä»¶çš„æŠ€è¡“åˆ†æã€‚

---

## ç›®éŒ„

1. [å°ˆæ¡ˆç›®æ¨™](#1-å°ˆæ¡ˆç›®æ¨™)
2. [Google Antigravity IDE æ¦‚è¿°](#2-google-antigravity-ide-æ¦‚è¿°)
3. [Antigravity æ“´å±•æ©Ÿåˆ¶](#3-antigravity-æ“´å±•æ©Ÿåˆ¶)
4. [Claude Code Hooks æ©Ÿåˆ¶](#4-claude-code-hooks-æ©Ÿåˆ¶)
5. [è‡ªå‹•è¿­ä»£å¾ªç’°åŸç†](#5-è‡ªå‹•è¿­ä»£å¾ªç’°åŸç†)
6. [ç¾æœ‰å¯¦ç¾å•é¡Œåˆ†æ](#6-ç¾æœ‰å¯¦ç¾å•é¡Œåˆ†æ)
7. [å»ºè­°çš„ä¿®æ­£æ–¹æ¡ˆ](#7-å»ºè­°çš„ä¿®æ­£æ–¹æ¡ˆ)
8. [åƒè€ƒè³‡æ–™](#8-åƒè€ƒè³‡æ–™)

---

## 1. å°ˆæ¡ˆç›®æ¨™

### 1.1 æ ¸å¿ƒç›®æ¨™

å‰µå»ºä¸€å€‹**è‡ªå‹•è¿­ä»£ä¿®å¾©å¾ªç’°æ’ä»¶**ï¼Œè®“ AI ä»£ç†ï¼ˆç„¡è«–æ˜¯ Geminiã€Claude æˆ– GPTï¼‰èƒ½å¤ ï¼š

1. **è‡ªå‹•åŸ·è¡Œ TDD å¾ªç’°**ï¼šç·¨ç¢¼ â†’ æ¸¬è©¦ â†’ ä¿®å¾©ï¼ŒæŒçºŒè¿­ä»£ç›´åˆ°æ‰€æœ‰æ¸¬è©¦é€šé
2. **æ™ºèƒ½æ””æˆª AI é€€å‡º**ï¼šç•¶ AI èªç‚ºä»»å‹™å®Œæˆä½†æ¸¬è©¦é‚„æœªé€šéæ™‚ï¼Œé‡æ–°æ³¨å…¥ä»»å‹™ prompt
3. **é¿å…ç„¡æ•ˆå¾ªç’°**ï¼šé€ééŒ¯èª¤å»é‡å’Œå¡ä½æª¢æ¸¬ï¼Œé¿å… AI é™·å…¥ç„¡é™è¿´åœˆ

### 1.2 æ”¯æ´çš„å¹³å°

| å¹³å° | æ”¯æ´çš„æ¨¡å‹ | ç‹€æ…‹ |
|------|-----------|------|
| **Google Antigravity** | Gemini 3 Pro (High/Low), Gemini 3 Flash, Claude Sonnet 4.5, Claude Opus 4.5, GPT-OSS 120B | ğŸ”„ ç ”ç©¶ä¸­ |
| **Claude Code** | Claude Sonnet, Claude Opus | âœ… æœ‰æ˜ç¢º API |

---

## 2. Google Antigravity IDE æ¦‚è¿°

### 2.1 ä»€éº¼æ˜¯ Antigravityï¼Ÿ

Google Antigravity æ˜¯ Google æ–¼ **2025 å¹´ 11 æœˆ 18 æ—¥**ç™¼å¸ƒçš„ **Agent-Firstï¼ˆä»£ç†å„ªå…ˆï¼‰é–‹ç™¼å¹³å°**ï¼Œéš¨ Gemini 3 ä¸€åŒç™¼å¸ƒã€‚

**é—œéµç‰¹é»ï¼š**
- ä¸åƒ…æ˜¯ç·¨è¼¯å™¨ï¼Œè€Œæ˜¯å¯ä»¥éƒ¨ç½²è‡ªä¸» AI ä»£ç†çš„é–‹ç™¼å¹³å°
- æ”¯æ´å¤šå€‹ AI æ¨¡å‹ï¼ˆGeminiã€Claudeã€GPTï¼‰
- ä»£ç†èƒ½å¤ åœ¨ç·¨è¼¯å™¨ã€çµ‚ç«¯æ©Ÿå’Œç€è¦½å™¨ä¸­è‡ªä¸»æ“ä½œ

### 2.2 Antigravity çš„é‹ä½œæ¨¡å¼

| æ¨¡å¼ | èªªæ˜ | AI è‡ªä¸»ç¨‹åº¦ |
|------|------|------------|
| **Agent-driven (Autopilot)** | AI è‡ªå‹•å¯«ç¨‹å¼ç¢¼ã€å‰µå»ºæª”æ¡ˆã€åŸ·è¡ŒæŒ‡ä»¤ | æœ€é«˜ |
| **Agent-assisted (æ¨è–¦)** | ä½¿ç”¨è€…æŒæ§ï¼ŒAI å”åŠ©å®‰å…¨çš„è‡ªå‹•åŒ– | ä¸­ç­‰ |
| **Review-driven** | AI åœ¨åŸ·è¡Œå¹¾ä¹ä»»ä½•å‹•ä½œå‰éƒ½éœ€è¦è¨±å¯ | æœ€ä½ |

### 2.3 çµ‚ç«¯åŸ·è¡Œç­–ç•¥

| ç­–ç•¥ | èªªæ˜ |
|------|------|
| **Off** | ä¸è‡ªå‹•åŸ·è¡Œä»»ä½•å‘½ä»¤ï¼Œæ¯å€‹å‘½ä»¤éƒ½éœ€è¦ç”¨æˆ¶ç¢ºèª |
| **Auto (æ¨è–¦)** | Agent è©•ä¼°é¢¨éšªï¼Œã€Œå®‰å…¨ã€å‘½ä»¤è‡ªå‹•åŸ·è¡Œï¼Œæœ‰é¢¨éšªçš„è«‹æ±‚æ‰¹å‡† |
| **Turbo** | å¹¾ä¹æ‰€æœ‰å‘½ä»¤è‡ªå‹•åŸ·è¡Œï¼Œé™¤äº† Deny List ä¸­çš„å‘½ä»¤ |

---

## 3. Antigravity æ“´å±•æ©Ÿåˆ¶

### 3.1 ä¸‰ç¨®ä¸»è¦æ“´å±•æ–¹å¼

| æ©Ÿåˆ¶ | èªªæ˜ | ä½ç½® |
|------|------|------|
| **Rulesï¼ˆè¦å‰‡ï¼‰** | ç³»çµ±ç´šæŒ‡ä»¤ï¼Œè‡ªå‹•è¼‰å…¥ï¼Œå§‹çµ‚ç”Ÿæ•ˆ | `.antigravity/rules.md` æˆ– `~/.gemini/GEMINI.md` |
| **Workflowsï¼ˆå·¥ä½œæµï¼‰** | æŒ‰éœ€è§¸ç™¼çš„å¯é‡ç”¨æç¤ºï¼ˆä½¿ç”¨ `/` æŒ‡ä»¤ï¼‰ | `.agent/workflows/*.md` |
| **MCP Servers** | Model Context Protocol ä¼ºæœå™¨é€£æ¥å¤–éƒ¨å·¥å…· | `mcp_config.json` |

### 3.2 ç›®éŒ„çµæ§‹

```
project-root/
â”œâ”€â”€ .agent/
â”‚   â”œâ”€â”€ workflows/           # å·¥ä½œæµç¨‹ï¼ˆæŒ‰éœ€è§¸ç™¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ create_component.md
â”‚   â”‚   â”œâ”€â”€ deploy.md
â”‚   â”‚   â””â”€â”€ for-loop.md      # æˆ‘å€‘çš„æ’ä»¶
â”‚   â””â”€â”€ rules/               # å°ˆæ¡ˆè¦å‰‡
â”‚
â”œâ”€â”€ .antigravity/
â”‚   â””â”€â”€ rules.md             # ä¸»è¦å°ˆæ¡ˆè¦å‰‡ï¼ˆè‡ªå‹•è¼‰å…¥ï¼‰
â”‚
â”œâ”€â”€ .context/                # çŸ¥è­˜åº«ï¼ˆè‡ªå‹•æ³¨å…¥åˆ° promptï¼‰
â”‚
â”œâ”€â”€ artifacts/               # ä»£ç†ç”¢å‡ºç‰©ï¼ˆè¨ˆåŠƒã€æ—¥èªŒã€è­‰æ“šï¼‰
â”‚
â””â”€â”€ mcp_servers.json         # MCP ä¼ºæœå™¨è¨­å®š
```

### 3.3 Workflow æ ¼å¼ï¼ˆé‡é»ï¼‰

Workflows æ˜¯**å¯æŒ‰éœ€è§¸ç™¼çš„è‡ªå‹•åŒ–è…³æœ¬**ï¼Œä½¿ç”¨ `/` æŒ‡ä»¤å•Ÿå‹•ã€‚

**å¿…è¦æ ¼å¼ï¼š**
1. å¿…é ˆæ”¾åœ¨ `.agent/workflows/` ç›®éŒ„
2. å¿…é ˆæ˜¯ `.md` (Markdown) æª”æ¡ˆ
3. **å¿…é ˆä»¥ YAML frontmatter é–‹é ­ï¼ŒåŒ…å« `description`**

**ç¯„ä¾‹ï¼š**
```markdown
---
description: å•Ÿå‹•è‡ªå‹•ä¿®å¾©è¿´åœˆ
---

1. è©¢å•ç”¨æˆ¶ä»»å‹™æè¿°
2. å»ºç«‹ç‹€æ…‹æª”æ¡ˆ
// turbo
3. åŸ·è¡Œ `npm test` (è‡ªå‹•åŸ·è¡Œï¼Œç„¡éœ€ç¢ºèª)
4. å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œä¿®å¾©ä»£ç¢¼
5. é‡è¤‡æ­¥é©Ÿ 3-4 ç›´åˆ°æ¸¬è©¦é€šé
```

### 3.4 Turbo æ¨¡å¼è¨»è§£

| è¨»è§£ | ä½œç”¨ç¯„åœ |
|------|---------|
| `// turbo` | åƒ…è©²æ­¥é©Ÿè‡ªå‹•åŸ·è¡Œ |
| `// turbo-all` | æ•´å€‹ workflow æ‰€æœ‰æŒ‡ä»¤è‡ªå‹•åŸ·è¡Œ |

### 3.5 Rules æª”æ¡ˆæ ¼å¼

Rules æ˜¯ AI ä»£ç†çš„ã€Œè¡Œç‚ºæº–å‰‡ã€ï¼Œè‡ªå‹•è¼‰å…¥ï¼Œå§‹çµ‚ç”Ÿæ•ˆï¼š

```markdown
# code-style-guide.md
* Make sure all the code is styled with PEP 8 style guide
* Make sure all the code is properly commented
* æ°¸é åœ¨å®Œæˆä»»å‹™å‰åŸ·è¡Œæ¸¬è©¦
* å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œè‡ªå‹•ä¿®å¾©ä¸¦é‡æ–°æ¸¬è©¦
```

### 3.6 é‡è¦ç™¼ç¾ï¼šAntigravity æ²’æœ‰ Stop Hook

**âš ï¸ é—œéµç™¼ç¾ï¼šGoogle Antigravity ç›®å‰æ²’æœ‰æ˜ç¢ºçš„ã€ŒStop Hookã€æˆ–å‚³çµ±æ„ç¾©ä¸Šçš„ç”Ÿå‘½é€±æœŸ hooks ç³»çµ±ã€‚**

é€™æ„å‘³è‘—æˆ‘å€‘çš„ `plugin.json` ä¸­å®šç¾©çš„ Stop Hook æ ¼å¼å¯èƒ½**ä¸è¢« Antigravity åŸç”Ÿæ”¯æ´**ã€‚

---

## 4. Claude Code Hooks æ©Ÿåˆ¶

### 4.1 Hook äº‹ä»¶é¡å‹

| äº‹ä»¶ | è§¸ç™¼æ™‚æ©Ÿ | ç”¨é€” |
|------|---------|------|
| `PreToolUse` | å·¥å…·åŸ·è¡Œå‰ | æ””æˆª/ä¿®æ”¹å·¥å…·åƒæ•¸ |
| `PostToolUse` | å·¥å…·åŸ·è¡Œå¾Œ | æä¾›åé¥‹çµ¦ Claude |
| `PermissionRequest` | é¡¯ç¤ºæ¬Šé™å°è©±æ¡†æ™‚ | è‡ªå‹•å…è¨±/æ‹’çµ• |
| `UserPromptSubmit` | ç”¨æˆ¶æäº¤ prompt æ™‚ | é©—è­‰/æ³¨å…¥ä¸Šä¸‹æ–‡ |
| **`Stop`** | **Claude å®Œæˆå›æ‡‰æ™‚** | **é˜»æ–·åœæ­¢ï¼Œæ³¨å…¥æ–°ä»»å‹™** |
| `SubagentStop` | å­ä»£ç†å®Œæˆæ™‚ | æ§åˆ¶å­ä»£ç†è¡Œç‚º |
| `SessionStart` | æœƒè©±é–‹å§‹æ™‚ | è¼‰å…¥ä¸Šä¸‹æ–‡ |
| `SessionEnd` | æœƒè©±çµæŸæ™‚ | æ¸…ç†ä»»å‹™ |

### 4.2 Stop Hook è©³ç´°èªªæ˜

Stop Hook æ˜¯å¯¦ç¾è‡ªå‹•è¿­ä»£å¾ªç’°çš„**æ ¸å¿ƒæ©Ÿåˆ¶**ã€‚

**è§¸ç™¼æ¢ä»¶ï¼š**
- ç•¶ä¸» Claude Code agent å®Œæˆå›æ‡‰æ™‚è§¸ç™¼
- **ä¸æœƒ**åœ¨ç”¨æˆ¶ä¸­æ–·æ™‚è§¸ç™¼

**é…ç½®æ ¼å¼ï¼ˆ`.claude/settings.json`ï¼‰ï¼š**
```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "hooks/on_stop.sh",
            "timeout": 60
          }
        ]
      }
    ]
  }
}
```

### 4.3 Hook è¼¸å‡ºæ§åˆ¶

#### Exit Code è¡Œç‚º

| Exit Code | è¡Œç‚º | stdout | stderr |
|-----------|------|--------|--------|
| **0** | å…è¨±åœæ­¢ | è§£æ JSONï¼ˆè‹¥æœ‰ï¼‰ | å¿½ç•¥ |
| **2** | **é˜»æ–·åœæ­¢** | **å¿½ç•¥** | **é¡¯ç¤ºçµ¦ Claude** |
| å…¶ä»– | éé˜»æ–·éŒ¯èª¤ | å¿½ç•¥ | é¡¯ç¤ºçµ¦ç”¨æˆ¶ |

#### JSON è¼¸å‡ºæ ¼å¼ï¼ˆExit Code 0ï¼‰

```json
{
  "decision": "block",
  "reason": "æ¸¬è©¦æœªé€šéï¼Œè«‹ç¹¼çºŒä¿®å¾©ã€‚éŒ¯èª¤ï¼šTypeError in line 42"
}
```

**é‡è¦æ¬„ä½ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `decision` | `"block"` \| `undefined` | `"block"` é˜»æ­¢ Claude åœæ­¢ |
| `reason` | `string` | **å¿…é ˆæä¾›**ï¼Œå‘Šè¨´ Claude å¦‚ä½•ç¹¼çºŒ |
| `continue` | `boolean` | `false` æ™‚å®Œå…¨åœæ­¢ Claude |
| `stopReason` | `string` | `continue: false` æ™‚é¡¯ç¤ºçš„è¨Šæ¯ |

### 4.4 Hook Input æ ¼å¼

Stop Hook æ”¶åˆ°çš„ JSON è¼¸å…¥ï¼š

```json
{
  "session_id": "abc123",
  "transcript_path": "~/.claude/projects/.../session.jsonl",
  "cwd": "/Users/.../project",
  "permission_mode": "default",
  "hook_event_name": "Stop",
  "stop_hook_active": true
}
```

**âš ï¸ é‡è¦**ï¼š`stop_hook_active` ç‚º `true` æ™‚è¡¨ç¤º Claude æ­£åœ¨å› ç‚º Stop Hook è€Œç¹¼çºŒã€‚æª¢æŸ¥æ­¤å€¼å¯ä»¥**é˜²æ­¢ç„¡é™è¿´åœˆ**ã€‚

### 4.5 Prompt-Based Hooksï¼ˆé€²éšï¼‰

Claude Code ä¹Ÿæ”¯æ´åŸºæ–¼ LLM çš„ hooksï¼š

```json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "è©•ä¼° Claude æ˜¯å¦æ‡‰è©²åœæ­¢ã€‚æª¢æŸ¥ï¼š1) æ‰€æœ‰ä»»å‹™æ˜¯å¦å®Œæˆ 2) æ˜¯å¦æœ‰éŒ¯èª¤éœ€è¦è™•ç†ã€‚è¼¸å…¥ï¼š$ARGUMENTS",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

---

## 5. è‡ªå‹•è¿­ä»£å¾ªç’°åŸç†

### 5.1 å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    For Loop å®Œæ•´å·¥ä½œæµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç”¨æˆ¶åŸ·è¡Œ /for-loop "ä»»å‹™æè¿°"
   â”‚
   â–¼
2. for-loop.sh å»ºç«‹ç‹€æ…‹æª”æ¡ˆ (.antigravity/for-loop-state.json)
   â”‚
   â–¼
3. AI Agent é–‹å§‹åŸ·è¡Œä»»å‹™ï¼ˆç·¨å¯«/ä¿®æ”¹ä»£ç¢¼ï¼‰
   â”‚
   â–¼
4. AI Agent èªç‚ºä»»å‹™å®Œæˆï¼Œå˜—è©¦åœæ­¢
   â”‚
   â–¼
5. Stop Hook (on_stop.sh) è¢«è§¸ç™¼
   â”‚
   â”œâ”€â”€â–º æª¢æŸ¥å®Œæˆæ¨™è¨˜ â”€â”€â–º æœ‰ â”€â”€â–º å…è¨±åœæ­¢ (exit 0)
   â”‚
   â”œâ”€â”€â–º æª¢æŸ¥è¿­ä»£ä¸Šé™ â”€â”€â–º é”åˆ° â”€â”€â–º å…è¨±åœæ­¢ (exit 0 + JSON)
   â”‚
   â”œâ”€â”€â–º åŸ·è¡Œæ¸¬è©¦å‘½ä»¤
   â”‚    â”‚
   â”‚    â”œâ”€â”€â–º æ¸¬è©¦é€šé â”€â”€â–º å…è¨±åœæ­¢ (exit 0)
   â”‚    â”‚
   â”‚    â””â”€â”€â–º æ¸¬è©¦å¤±æ•— â”€â”€â–º æª¢æŸ¥å¡ä½ç‹€æ…‹
   â”‚                      â”‚
   â”‚                      â”œâ”€â”€â–º å¡ä½ â”€â”€â–º å…è¨±åœæ­¢ (exit 0 + JSON)
   â”‚                      â”‚
   â”‚                      â””â”€â”€â–º æœªå¡ä½ â”€â”€â–º é˜»æ–·åœæ­¢
   â”‚                                      â”‚
   â”‚                                      â–¼
   â”‚                                æ›´æ–°ç‹€æ…‹æª”æ¡ˆ
   â”‚                                      â”‚
   â”‚                                      â–¼
   â”‚                                è¼¸å‡ºæ–°çš„ prompt
   â”‚                                (exit 0 + JSON decision: block)
   â”‚                                      â”‚
   â–¼                                      â–¼
6. â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AI æ”¶åˆ°æ–°ä»»å‹™ï¼Œè¿”å›æ­¥é©Ÿ 3
```

### 5.2 ç‹€æ…‹æª”æ¡ˆæ ¼å¼

```json
{
  "iteration": 3,
  "max_iterations": 10,
  "completion_promise": "DONE",
  "original_prompt": "ä¿®å¾©æ‰€æœ‰ TypeScript éŒ¯èª¤",
  "test_command": "npm test",
  "stuck_threshold": 3,
  "stuck_count": 0,
  "last_error_hash": "a1b2c3d4...",
  "branch": "for-loop/20260105_143000",
  "started_at": "2026-01-05T14:30:00+08:00",
  "status": "running"
}
```

### 5.3 å¹³å°é©é…ç­–ç•¥

ç”±æ–¼ Antigravity å’Œ Claude Code çš„æ©Ÿåˆ¶ä¸åŒï¼Œéœ€è¦ä¸åŒçš„é©é…ç­–ç•¥ï¼š

| å¹³å° | Stop Hook æ”¯æ´ | æ›¿ä»£æ–¹æ¡ˆ |
|------|---------------|---------|
| **Claude Code** | âœ… åŸç”Ÿæ”¯æ´ | ä½¿ç”¨ `.claude/settings.json` é…ç½® |
| **Antigravity** | âŒ ä¸æ”¯æ´ | ä½¿ç”¨ **Workflows + Rules** çµ„åˆ |

#### Antigravity æ›¿ä»£æ–¹æ¡ˆ

1. **ä½¿ç”¨ Workflow å®šç¾©è¿´åœˆæ­¥é©Ÿ**ï¼š
```markdown
---
description: è‡ªå‹•ä¿®å¾©è¿´åœˆ
---

// turbo-all
1. åŸ·è¡Œæ¸¬è©¦å‘½ä»¤
2. å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œåˆ†æéŒ¯èª¤ä¸¦ä¿®å¾©
3. é‡è¤‡æ­¥é©Ÿ 1-2 ç›´åˆ°æ¸¬è©¦é€šéæˆ–é”åˆ° 10 æ¬¡è¿­ä»£
```

2. **ä½¿ç”¨ Rules å¼·åˆ¶è¡Œç‚º**ï¼š
```markdown
# .antigravity/rules.md

ç•¶åŸ·è¡Œ /for-loop å·¥ä½œæµæ™‚ï¼š
- æ°¸é åœ¨ä¿®æ”¹ä»£ç¢¼å¾ŒåŸ·è¡Œæ¸¬è©¦
- å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œå¿…é ˆç¹¼çºŒä¿®å¾©ï¼Œä¸å¯åœæ­¢
- åªæœ‰åœ¨æ‰€æœ‰æ¸¬è©¦é€šéæˆ–é”åˆ°è¿­ä»£ä¸Šé™æ™‚æ‰å¯åœæ­¢
- æ¯æ¬¡è¿­ä»£éƒ½è¦å ±å‘Šé€²åº¦
```

---

## 6. ç¾æœ‰å¯¦ç¾å•é¡Œåˆ†æ

### 6.1 é«˜å„ªå…ˆç´šå•é¡Œ

#### å•é¡Œ 1ï¼šStop Hook è¼¸å‡ºæ ¼å¼éŒ¯èª¤

**å•é¡Œ**ï¼šä½¿ç”¨ `exit 2` æ™‚ï¼Œstdout çš„ JSON æœƒè¢«å¿½ç•¥ã€‚

**ç›®å‰çš„éŒ¯èª¤å¯¦ç¾** (`hooks/on_stop.sh:156-164`)ï¼š
```bash
jq -n \
    --arg msg "$user_message" \
    '{
        "outcome": { "decision": "block" },
        "userMessage": $msg
    }'
exit 2  # âŒ JSON æœƒè¢«å¿½ç•¥ï¼
```

**æ­£ç¢ºå¯¦ç¾**ï¼š
```bash
# æ–¹æ¡ˆ Aï¼šä½¿ç”¨ exit 0 + JSON
jq -n \
    --arg msg "$user_message" \
    '{
        "decision": "block",
        "reason": $msg
    }'
exit 0

# æˆ–æ–¹æ¡ˆ Bï¼šä½¿ç”¨ exit 2 + stderr
echo "$user_message" >&2
exit 2
```

#### å•é¡Œ 2ï¼šæ¸¬è©¦æˆåŠŸåˆ¤æ–·é‚è¼¯æœ‰ç¼ºé™·

**å•é¡Œ**ï¼š`exit code = 0` ä½†ä¸å«é—œéµå­—æ™‚æœƒèª¤åˆ¤ç‚ºå¤±æ•—ã€‚

**ç›®å‰çš„éŒ¯èª¤å¯¦ç¾** (`hooks/on_stop.sh:85-91`)ï¼š
```bash
if [[ $test_exit_code -eq 0 ]]; then
    if echo "$test_output" | grep -qiE "(passed|success|ok|âœ“)"; then
        # åªæœ‰åŒæ™‚æ»¿è¶³æ‰ç®—æˆåŠŸ âŒ
    fi
fi
```

**æ­£ç¢ºå¯¦ç¾**ï¼š
```bash
# ä»¥ exit code ç‚ºä¸»åˆ¤æ–·
if [[ $test_exit_code -eq 0 ]]; then
    log "âœ… æ¸¬è©¦é€šé (exit code: 0)"
    rm -f "$STATE_FILE"
    exit 0
fi
```

### 6.2 ä¸­å„ªå…ˆç´šå•é¡Œ

#### å•é¡Œ 3ï¼šmd5sum è·¨å¹³å°å•é¡Œ

**å•é¡Œ**ï¼šmacOS æ²’æœ‰ `md5sum`ï¼Œåªæœ‰ `md5`ã€‚

**ä¿®æ­£**ï¼š
```bash
compute_hash() {
    if command -v md5sum &> /dev/null; then
        md5sum | cut -d' ' -f1
    elif command -v md5 &> /dev/null; then
        md5 -q
    elif command -v shasum &> /dev/null; then
        shasum -a 256 | cut -d' ' -f1
    else
        wc -c | tr -d ' '
    fi
}
```

#### å•é¡Œ 4ï¼štest_command JSON è½‰ç¾©å•é¡Œ

**å•é¡Œ**ï¼šå«ç‰¹æ®Šå­—å…ƒæ™‚æœƒç ´å£ JSONã€‚

**ä¿®æ­£**ï¼šä½¿ç”¨ `jq` å»ºç«‹ JSONï¼š
```bash
jq -n \
    --arg test_cmd "$TEST_COMMAND" \
    '{ "test_command": $test_cmd }' > "$STATE_FILE"
```

### 6.3 ä½å„ªå…ˆç´šå•é¡Œ

| å•é¡Œ | èªªæ˜ | ä¿®æ­£å»ºè­° |
|------|------|---------|
| plugin.json è¨­å®šæœªè®€å– | ç”¨æˆ¶ä¿®æ”¹é…ç½®ä¸ç”Ÿæ•ˆ | åœ¨è…³æœ¬ä¸­è®€å– plugin.json |
| shellspec æœªåˆ—å…¥ä¾è³´ | æ–°è²¢ç»è€…ç„¡æ³•é‹è¡Œæ¸¬è©¦ | åŠ å…¥ devDependencies |
| Windows ä¸æ”¯æ´ bash | extension.js ç›´æ¥å‘¼å« bash | åŠ å…¥å¹³å°é™åˆ¶èªªæ˜ |

---

## 7. å»ºè­°çš„ä¿®æ­£æ–¹æ¡ˆ

### 7.1 ä¿®æ­£å„ªå…ˆé †åº

| å„ªå…ˆç´š | å•é¡Œ | å·¥ä½œé‡ |
|--------|------|--------|
| ğŸ”´ P0 | ä¿®æ”¹ Stop Hook è¼¸å‡ºæ ¼å¼ | å° |
| ğŸ”´ P0 | ä¿®æ­£æ¸¬è©¦æˆåŠŸåˆ¤æ–·é‚è¼¯ | å° |
| ğŸŸ¡ P1 | åŠ å…¥ md5sum è·¨å¹³å° fallback | å° |
| ğŸŸ¡ P1 | ä½¿ç”¨ jq å»ºç«‹ JSON | ä¸­ |
| ğŸŸ¢ P2 | é€£æ¥ plugin.json é…ç½® | ä¸­ |
| ğŸŸ¢ P2 | è£œå…… shellspec ä¾è³´ | å° |
| ğŸŸ¢ P2 | åŠ å…¥å¹³å°é™åˆ¶èªªæ˜ | å° |

### 7.2 å»ºè­°çš„æ¶æ§‹èª¿æ•´

ç‚ºäº†åŒæ™‚æ”¯æ´ Antigravity å’Œ Claude Codeï¼Œå»ºè­°ï¼š

```
antigravity_for_loop/
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ settings.json        # Claude Code Hook é…ç½®
â”œâ”€â”€ .agent/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ for-loop.md      # Antigravity Workflow
â”œâ”€â”€ .antigravity/
â”‚   â””â”€â”€ rules.md             # Antigravity Rules
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ for-loop.sh
â”‚   â””â”€â”€ cancel-loop.sh
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ on_stop.sh           # é€šç”¨ Hookï¼ˆå¯è¢«å…©å¹³å°ä½¿ç”¨ï¼‰
â””â”€â”€ ...
```

### 7.3 Claude Code é…ç½®ç¯„ä¾‹

`.claude/settings.json`ï¼š
```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PROJECT_DIR}/hooks/on_stop.sh",
            "timeout": 120
          }
        ]
      }
    ]
  }
}
```

### 7.4 Antigravity Workflow ç¯„ä¾‹

`.agent/workflows/for-loop.md`ï¼š
```markdown
---
description: å•Ÿå‹•è‡ªå‹•ä¿®å¾©è¿´åœˆ - è®“ AI æŒçºŒåŸ·è¡Œç›´åˆ°æ¸¬è©¦é€šé
---

# For Loop Workflow

é€™å€‹ Workflow ç”¨æ–¼å•Ÿå‹•è‡ªå‹•ä¿®å¾©è¿´åœˆã€‚

## å•Ÿå‹•æ­¥é©Ÿ

1. è©¢å•ç”¨æˆ¶ä»»å‹™æè¿°å’Œæ¸¬è©¦å‘½ä»¤
2. å»ºç«‹ç‹€æ…‹æª”æ¡ˆè¨˜éŒ„è¿­ä»£é€²åº¦
// turbo
3. åŸ·è¡Œåˆå§‹åŒ–è…³æœ¬ï¼š`bash ./commands/for-loop.sh "$TASK" --test-command "$TEST_CMD"`

## è¿­ä»£å¾ªç’°

// turbo-all
4. åŸ·è¡Œæ¸¬è©¦å‘½ä»¤ä¸¦æ•ç²è¼¸å‡º
5. å¦‚æœæ¸¬è©¦é€šéï¼ŒçµæŸè¿´åœˆ
6. å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œåˆ†æéŒ¯èª¤ä¸¦ä¿®å¾©ä»£ç¢¼
7. æ›´æ–°è¿­ä»£è¨ˆæ•¸
8. å¦‚æœæœªé”è¿­ä»£ä¸Šé™ï¼Œè¿”å›æ­¥é©Ÿ 4
9. å¦‚æœé”åˆ°ä¸Šé™ï¼Œå ±å‘Šä¸¦çµæŸ

## å®Œæˆæ¢ä»¶

- æ‰€æœ‰æ¸¬è©¦é€šé
- é”åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•¸ (é è¨­ 10)
- åµæ¸¬åˆ°é‡è¤‡éŒ¯èª¤ (å¡ä½)
```

---

## 8. åƒè€ƒè³‡æ–™

### å®˜æ–¹æ–‡æª”

- [Claude Code Hooks å®˜æ–¹æ–‡æª”](https://code.claude.com/docs/en/hooks)
- [Google Antigravity å®˜æ–¹æ–‡æª”](https://antigravity.google/docs/home)
- [Antigravity Workflows æŒ‡å—](https://antigravity.codes/blog/workflows)

### ç¤¾ç¾¤è³‡æº

- [Antigravity System Prompt (æ´©éœ²)](https://gist.github.com/Phantomn/ac35e2eb15be2eb63bc58f5eeee9c99a)
- [Claude Code Stop Hook Issue #10412](https://github.com/anthropics/claude-code/issues/10412)
- [Antigravity Workspace Template](https://github.com/study8677/antigravity-workspace-template)

### ç›¸é—œæ’ä»¶åƒè€ƒ

- [claude-workflow](https://github.com/CloudAI-X/claude-workflow) - Claude Code å·¥ä½œæµæ’ä»¶
- [claude-code-spec-workflow](https://github.com/Pimzino/claude-code-spec-workflow) - è¦æ ¼é©…å‹•é–‹ç™¼
- [compound-engineering-plugin](https://github.com/EveryInc/compound-engineering-plugin) - è¤‡åˆå·¥ç¨‹æµç¨‹

---

## é™„éŒ„ Aï¼šAntigravity æ”¯æ´çš„æ¨¡å‹

| æ¨¡å‹ | èªªæ˜ |
|------|------|
| Gemini 3 Pro (High) | Google æœ€æ–°æ——è‰¦æ¨¡å‹ï¼Œé«˜æ€§èƒ½ |
| Gemini 3 Pro (Low) | ä½å»¶é²ç‰ˆæœ¬ |
| Gemini 3 Flash | å¿«é€Ÿæ¨ç† |
| Claude Sonnet 4.5 | Anthropic ä¸­éšæ¨¡å‹ |
| Claude Sonnet 4.5 (Thinking) | å¸¶æ€ç¶­éˆç‰ˆæœ¬ |
| Claude Opus 4.5 (Thinking) | Anthropic æ——è‰¦æ¨¡å‹ |
| GPT-OSS 120B (Medium) | OpenAI é–‹æºæ¨¡å‹ |

## é™„éŒ„ Bï¼šå·²çŸ¥å®‰å…¨æ¼æ´

æ ¹æ“š Mindgard å’Œ Embrace The Red çš„å ±å‘Šï¼ŒAntigravity å­˜åœ¨ä»¥ä¸‹å®‰å…¨å•é¡Œï¼ˆä¾›åƒè€ƒï¼‰ï¼š

| æ¼æ´ | æè¿° |
|------|------|
| Remote Command Execution | é€šéé–“æ¥ Prompt Injection åŸ·è¡Œä»»æ„å‘½ä»¤ |
| Hidden Unicode Instructions | ä½¿ç”¨ Unicode Tag å­—å…ƒéš±è—æƒ¡æ„æŒ‡ä»¤ |
| MCP ç„¡äººå·¥å¯©æ ¸ | MCP å·¥å…·å‘¼å«ä¸éœ€è¦ä½¿ç”¨è€…ç¢ºèª |
| Persistent Backdoor | å¯«å…¥å…¨åŸŸè¨­å®šç›®éŒ„å¯¦ç¾æŒä¹…åŒ–å¾Œé–€ |

**å»ºè­°**ï¼šåœ¨ Turbo æ¨¡å¼ä¸‹ä½¿ç”¨æ™‚éœ€è¬¹æ…ï¼Œå»ºè­°é…ç½®é©ç•¶çš„ Deny Listã€‚
